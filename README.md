# RailWiFi ‚Äî –ø–ª–∞—Ç—ë–∂–Ω—ã–π captive‚Äë–ø–æ—Ä—Ç–∞–ª

**RailWiFi** ‚Äî —ç—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π Wi‚ÄëFi captive‚Äë–ø–æ—Ä—Ç–∞–ª –¥–ª—è –ø–æ–µ–∑–¥–æ–≤/–∫–∞—Ñ–µ/–æ—Ñ–∏—Å–æ–≤ —Å –æ–ø–ª–∞—Ç–æ–π –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º –∏ –ø—Ä–æ—Å—Ç–æ–π –∞–¥–º–∏–Ω–∫–æ–π. 
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç MAC‚Äë–∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ –∏ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç (–≤ –ø—Ä–æ–µ–∫—Ç–µ ‚Äî —á–µ—Ä–µ–∑ STUB‚Äë–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Kaspi/QR). 
–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–∞—Ä–∏—Ñ–∞–º–∏.


## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã (Stub –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Kaspi/QR).
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ MAC, –≤—ã–¥–∞—á–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–æ—Å–æ–º —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞.
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—Ö–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞.
- –ê–¥–º–∏–Ω–∫–∞: –≤—Ö–æ–¥ –ø–æ –ª–æ–≥–∏–Ω—É/–ø–∞—Ä–æ–ª—é, –ø—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π, –ø—Ä–æ–¥–ª–µ–Ω–∏–µ/—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ, CRUD —Ç–∞—Ä–∏—Ñ–æ–≤.
- REST API —Å Swagger (NestJS), Prisma/PostgreSQL.

## üß± –°—Ç–µ–∫

- **Frontend:** Next.js 15 (React 19), TypeScript, TailwindCSS 4.
- **Backend:** NestJS 11, Prisma ORM, PostgreSQL.
- **–í—Ä–µ–º—è/—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** date‚Äëfns, date‚Äëfns‚Äëtz.
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω–∫–∏:** JWT + HTTP‚Äëonly cookie.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** –∑–∞–≥–ª—É—à–∫–∏ Kaspi (–æ–ø–ª–∞—Ç–∞) –∏ Omada (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ MAC).

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
/api   ‚Äî NestJS + Prisma (REST API)
/web   ‚Äî Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–æ—Ä—Ç–∞–ª + –∞–¥–º–∏–Ω–∫–∞)
```

–ö–ª—é—á–µ–≤—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –±—ç–∫–µ–Ω–¥–∞:
```
api/src/
  admin/            ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞–¥–º–∏–Ω–∫–∏ (–ª–æ–≥–∏–Ω, —Ç–∞—Ä–∏—Ñ—ã, —Å–µ—Å—Å–∏–∏)
  payments/         ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞, —Å—Ç–∞—Ç—É—Å, mock‚Äë–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    adapters/       ‚Äî –∑–∞–≥–ª—É—à–∫–∏ Kaspi –∏ Omada
  portal/           ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ MAC (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞)
  tariffs/          ‚Äî —Å–µ—Ä–≤–∏—Å —Ç–∞—Ä–∏—Ñ–æ–≤
  common/time       ‚Äî —Å–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–∏/—Ç–∞–π–º–∑–æ–Ω—ã (Asia/Almaty)
  prisma/           ‚Äî –º–æ–¥—É–ª—å Prisma (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î)
prisma/schema.prisma ‚Äî –º–æ–¥–µ–ª–∏: Tariff, Device, Payment, AccessTicket, Session
```

–ö–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:
```
/        ‚Äî –≤–≤–æ–¥ MAC, –≤—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞, –∫–Ω–æ–ø–∫–∞ ¬´–û–ø–ª–∞—Ç–∏—Ç—å¬ª
/pay/[id]?mac=...  ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã, –æ–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞, –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É (STUB)¬ª
/success?mac=...   ‚Äî —É—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
/admin/login       ‚Äî –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É
/admin             ‚Äî –¥–∞—à–±–æ—Ä–¥: —Å–µ—Å—Å–∏–∏ + —Ç–∞—Ä–∏—Ñ—ã
```

## ‚öôÔ∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 1) PostgreSQL

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ Docker:

```bash
docker run -d --name wifi-postgres \
  -e POSTGRES_USER=wifi_user -e POSTGRES_PASSWORD=StrongPass_123 \
  -e POSTGRES_DB=wifi_train -p 5432:5432 postgres:16
```

### 2) –ö–æ–Ω—Ñ–∏–≥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `api/.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:

```ini
DATABASE_URL="postgresql://wifi_user:StrongPass_123@localhost:5432/wifi_train?schema=public"
PORT=5001
TIMEZONE=Asia/Almaty
CORS_ORIGINS=http://localhost:3000

ADMIN_USER=admin
ADMIN_PASS=admin123
ADMIN_JWT_SECRET=supersecret_change_me
ADMIN_COOKIE_NAME=admin_token
```

–°–æ–∑–¥–∞–π—Ç–µ `web/.env.local`:

```ini
NEXT_PUBLIC_API_BASE_URL=http://localhost:5001/api
```

## ‚ñ∂Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

### Backend (API)
```bash
cd api
npm i
npx prisma migrate dev   # –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npm run db:seed          # –∑–∞—Å–µ—è—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç–∞—Ä–∏—Ñ—ã
npm run start:dev        # http://localhost:5001
```

### Frontend (Web)
```bash
cd web
npm i
npm run dev              # http://localhost:3000
```

> **CORS:** —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `CORS_ORIGINS` –≤ `api/.env` —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–¥—Ä–µ—Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É (STUB)

1. –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–≤–µ–¥–∏—Ç–µ MAC (–Ω–∞–ø—Ä–∏–º–µ—Ä, `AA-BB-CC-11-22-33`), –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ ‚Äî –Ω–∞–∂–º–∏—Ç–µ **–û–ø–ª–∞—Ç–∏—Ç—å**.
2. –í—ã –ø–æ–ø–∞–¥—ë—Ç–µ –Ω–∞ `/pay/[id]`. –ó–¥–µ—Å—å –∏–¥—ë—Ç –∞–≤—Ç–æ‚Äë–æ–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫.
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **¬´–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É (STUB)¬ª** ‚Äî —Å—Ç–∞—Ç—É—Å —Å–º–µ–Ω–∏—Ç—Å—è –Ω–∞ *paid*.
4. –í–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ `/success?mac=...`, –≥–¥–µ –≤–∏–¥–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞.

## üîê –ê–¥–º–∏–Ω–∫–∞

- –í—Ö–æ–¥: `http://localhost:3000/admin/login`
- –õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å ‚Äî –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö `ADMIN_USER` / `ADMIN_PASS`.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
  - –°–µ—Å—Å–∏–∏: —Å–ø–∏—Å–æ–∫, –ø–æ–∏—Å–∫ –ø–æ MAC, –ø—Ä–æ–¥–ª–µ–Ω–∏–µ (+–º–∏–Ω) / —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ (‚àí–º–∏–Ω).
  - –¢–∞—Ä–∏—Ñ—ã: —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö, –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ.

## üóÑÔ∏è –°—Ö–µ–º–∞ –ë–î (Prisma)

–ú–æ–¥–µ–ª–∏:
- **Tariff** ‚Äî —Ç–∞—Ä–∏—Ñ—ã (–Ω–∞–∑–≤–∞–Ω–∏–µ, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–Ω—É—Ç–∞—Ö, —Ü–µ–Ω–∞ KZT, `active`).
- **Device** ‚Äî —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (MAC).
- **Payment** ‚Äî –ø–ª–∞—Ç–µ–∂–∏ (—Å—É–º–º–∞, —Å—Ç–∞—Ç—É—Å: `created|pending|paid|failed|expired|refunded`, –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏ id –∑–∞–∫–∞–∑–∞).
- **AccessTicket** ‚Äî –±–∏–ª–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏).
- **Session** ‚Äî —Å–µ—Å—Å–∏–∏ (—É—á—ë—Ç —Ç—Ä–∞—Ñ–∏–∫–∞; –¥–ª—è MVP ‚Äî –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è).

> –î–ª—è MVP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ `Kaspi` –∏ `Omada` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ –∑–∞–≥–ª—É—à–∫–∏ –≤ `api/src/payments/adapters/`. –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —Å—é–¥–∞ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è SDK/HTTP‚Äë–∫–ª–∏–µ–Ω—Ç—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤.

## üì¶ –°–∫—Ä–∏–ø—Ç—ã

- Backend:
  - `npm run start:dev` ‚Äî –∑–∞–ø—É—Å–∫ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
  - `npm run db:seed` ‚Äî –±–∞–∑–æ–≤—ã–µ —Ç–∞—Ä–∏—Ñ—ã
  - `npx prisma studio` ‚Äî –≤–µ–±‚ÄëUI –¥–ª—è –ë–î
- Frontend:
  - `npm run dev` ‚Äî dev‚Äë—Å–µ—Ä–≤–µ—Ä Next.js
  - `npm run build && npm start` ‚Äî –ø—Ä–æ–¥–∞–∫—à–Ω‚Äë—Å–±–æ—Ä–∫–∞

## üöÄ –î–µ–ø–ª–æ–π (–∫—Ä–∞—Ç–∫–æ)

- –ë—ç–∫–µ–Ω–¥ ‚Äî Node.js —Å–µ—Ä–≤–∏—Å –∑–∞ Nginx, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∫–∞–∫ –≤ `.env`.
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî —Å—Ç–∞—Ç–∏–∫–∞ Next.js (`npm run build`), reverse‚Äëproxy –∫ API.
- –ë–î ‚Äî —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π PostgreSQL (–∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä).
